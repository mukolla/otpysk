<?php
/*

		$conn = new Lib_connecteddb;
		$db = $conn->connect();
		$result = $db->prepare("SELECT * FROM user");
		$result->execute();
		*/

 class Application_Models_Auth
  {	  
	  function ValidData($login,$pass){
		$post = Lib_Proc::getInstance()->ClearArrayDate($_POST);
		
		

	
		$userdb = new Application_Models_userdb;
	 	$user_data = $userdb->_get_all_user_db();

		foreach ($user_data as $row){
			if ($login == $row['user_name'] && md5($pass) == $row['pass'])
			{
				$_SESSION['auth']=true;  
				$_SESSION['user_name']	= $row['user_name'];
				$_SESSION['mail']		= $row['mail'];
				$_SESSION['user_status']= $row['user_status'];
				$_SESSION['user_id']	= $row['user_id'];
				$_SESSION['img_avatar']	= $row['img_avatar'];
				//setcookie('user_count', mysql_num_rows($rows),NULL,'/');
				$adminmodels = new Application_Models_Admin;
				$date = $adminmodels->UpdateUsers(); // update date last activity from user
			return false;
			}
		}
		return true;
	  }

	  function NewUserValidData($username,$email){
		$sql = "SELECT * FROM `user`";
		$rows = mysql_query($sql);
		while ($result = mysql_fetch_array($rows))
		{

			if ($username == $result['user_name'] &&  $email == $result['mail'])
			{			
				return true;
			}
		}
		return false;
	  }

  	  function AddUser($value){
		$value = Lib_Proc::getInstance()->ClearArrayDate($value);
		
		if (Lib_Proc::getInstance()->ValidateLoginDate($value)){
			$sql = "INSERT INTO `user` (`user_name`, `pass`, `mail`, `reg_date`, `first_name`, `last_name`, `img_avatar`) VALUES ('".$value['username']."', '".md5($value['password'])."', '".$value['email']."', '".date("m.d.Y g:i")."','".$value['first_name']."','".$value['last_name']."','".$value['img_avatar']."')";
			mysql_query($sql) or die($msg = mysql_error());
			$msg = 'Реєстраційні дані введені вірно!';
			
		}else{
			$msg = 'Реєстраційні дані введені не вірно';
		}
		return $msg;
	  }

	  function del_user($value){
			$sql = "DELETE FROM `user` WHERE (`user_id`='".$value."') ;";
			mysql_query($sql) or die(mysql_error());
		return true;
	  }
	
  
  } 

?>  